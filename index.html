<!DOCTYPE HTML>
<html>

<head>
    <title>Altir Craft</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="./resources/css/style.css">
    <link rel="stylesheet" href="./resources/css/libs/pannellum.css"/>
    <link rel="icon" id="icon">
</head>

<body>
    <main>
        <div id="bg"></div>

        <section id="info" class="loading">
            <div id="title">
                <img src="./resources/images/logo.png" id="logo">
                <div id="splash-wrapper">
                    <p id="splash"></p>
                </div>
            </div>

            <ul id="buttons">
                <li class="button" onclick="playClickSound(); location.href = 'http:/\/map.bebra.bitor.in'">
                    <div class="label">Map</div>
                </li>
                <li class="button">
                    <div class="label" onclick="playClickSound(); showPlayers();">Players</div>
                    <ul id="players"></ul>
                </li>
            </ul>
        </section>
    </main>

    <script src="./resources/js/libs/pannellum.js"></script>

    <script>
        // ==================================

        const request = new XMLHttpRequest();
        request.open("GET", "https://api.mcsrvstat.us/2/bebra.bitor.in", false);
        request.send(null);

        const server = JSON.parse(request.response);

        // ==================================

        document.getElementById("icon").setAttribute("href", server.icon ?? "./resources/images/no-icon.png");

        // ==================================

        const splashes = [
            "server hosted in donetsk, ukraine",
            "100% bebra",
            "rule no. 1 no anime",
            "sexcraft edition with all addons",
            "powered by unreal engine",
            "no sex"
        ];

        const splash = splashes[Math.floor(Math.random() * splashes.length)];
        const element = document.getElementById("splash");

        const fontSize = (35 - Math.min(splash.length / 1.5, 30));

        element.style.fontSize = fontSize + "px";
        element.innerHTML = splash;

        // ==================================

        const click = new Audio("./resources/sounds/click.ogg");
        click.volume = 0.3;

        function playClickSound() {
            click.play();
        }

        // ==================================

        const players = document.getElementById("players");

        function showPlayers() {
            players.style.display = players.style.display === "none" || !players.style.display ? "block" : "none";
        }

        const list = server.players?.list;

        if(list) {
            for(const player of list)
                players.innerHTML += `
                    <li class="player">
                        <img src="https://minotar.net/avatar/${player}" class="avatar">
                        ${player}
                    </li>
                `;
        } else
            players.parentElement.style.display = "none";

        // ==================================

        const viewer = pannellum.viewer("bg", {
            "type": "equirectangular",
            "panorama": "./resources/images/panorama.png",
            "autoLoad": true,
            "showControls": false,
            "autoRotate": 3,
            "hfov": 110
        });

        viewer.on("load", () => document.getElementById("info").className = "loaded");

        document.getElementsByClassName("pnlm-about-msg")[0].remove();
        document.getElementsByClassName("pnlm-lbox")[0].remove();
        document.getElementsByClassName("pnlm-lbar")[0].remove();
        document.getElementsByClassName("pnlm-lmsg")[0].remove();

        // ==================================
    </script>
</body>

</html>